<!DOCTYPE html>
<html>
<head>
    <title>简单登录测试</title>
</head>
<body>
    <h1>简单登录测试</h1>
    
    <div>
        <input type="text" id="username" value="admin" placeholder="用户名">
        <input type="password" id="password" value="admin123" placeholder="密码">
        <button onclick="testLogin()">测试登录</button>
    </div>
    
    <div id="result"></div>
    
    <hr>
    
    <div>
        <button onclick="checkSession()">检查会话</button>
        <button onclick="resetAdmin()">重置管理员</button>
    </div>
    
    <div id="result2"></div>

    <script>
        function showResult(id, message, isError = false) {
            const div = document.getElementById(id);
            div.innerHTML = message;
            div.style.color = isError ? 'red' : 'green';
        }

        async function testLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            showResult('result', '正在登录...', false);
            
            try {
                const response = await fetch('https://market-link-logistics.onrender.com/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                console.log('登录响应:', response.status, data);
                
                if (response.ok && data.success) {
                    showResult('result', '登录成功！用户: ' + JSON.stringify(data.user));
                } else {
                    showResult('result', '登录失败: ' + (data.error || '未知错误'), true);
                }
            } catch (error) {
                console.error('登录错误:', error);
                showResult('result', '网络错误: ' + error.message, true);
            }
        }

        async function checkSession() {
            showResult('result2', '检查中...', false);
            
            try {
                const response = await fetch('https://market-link-logistics.onrender.com/api/auth/whoami', {
                    credentials: 'include'
                });
                
                const data = await response.json();
                console.log('会话检查响应:', response.status, data);
                
                if (data.user) {
                    showResult('result2', '已登录: ' + JSON.stringify(data.user));
                } else {
                    showResult('result2', '未登录: ' + JSON.stringify(data), true);
                }
            } catch (error) {
                console.error('会话检查错误:', error);
                showResult('result2', '检查失败: ' + error.message, true);
            }
        }

        async function resetAdmin() {
            showResult('result2', '重置中...', false);
            
            try {
                const response = await fetch('https://market-link-logistics.onrender.com/api/auth/admin-seed?key=temp-allow&pwd=admin123', {
                    credentials: 'include'
                });
                
                const data = await response.json();
                console.log('重置响应:', response.status, data);
                
                if (response.ok && data.success) {
                    showResult('result2', '管理员密码重置成功！');
                } else {
                    showResult('result2', '重置失败: ' + (data.error || '未知错误'), true);
                }
            } catch (error) {
                console.error('重置错误:', error);
                showResult('result2', '重置失败: ' + error.message, true);
            }
        }

        // 页面加载完成后自动检查会话
        window.onload = function() {
            checkSession();
        };
    </script>
</body>
</html>
